"use strict";var RTCMultiConnection=function(e,n){function t(e,n){function t(e){return!e.audio&&!e.video&&!e.screen&&e.data}function o(n,t){e.peersBackup[n]||(e.peersBackup[n]={userid:n,extra:{}}),e.peersBackup[n].extra=t}var i="";i+="?userid="+e.userid,i+="&sessionid="+e.sessionid,i+="&msgEvent="+e.socketMessageEvent,i+="&socketCustomEvent="+e.socketCustomEvent,i+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(i+="&oneToMany=true"),i+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(i+="&enableScalableBroadcast=true",i+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),i+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(i+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=io(e.socketURL+i)}catch(n){e.socket=io.connect(e.socketURL+i,e.socketOptions)}var r=e.multiPeersHandler;e.socket.on("extra-data-updated",function(n,t){e.peers[n]&&(e.peers[n].extra=t,e.onExtraDataUpdated({userid:n,extra:t}),o(n,t))}),e.socket.on(e.socketMessageEvent,function n(i){if(i.remoteUserId==e.userid){if(e.peers[i.sender]&&e.peers[i.sender].extra!=i.message.extra&&(e.peers[i.sender].extra=i.extra,e.onExtraDataUpdated({userid:i.sender,extra:i.extra}),o(i.sender,i.extra)),i.message.streamSyncNeeded&&e.peers[i.sender]){var s=e.streamEvents[i.message.streamid];if(!s||!s.stream)return;var a=i.message.action;if("ended"===a||"inactive"===a||"stream-removed"===a)return e.peersBackup[s.userid]&&(s.extra=e.peersBackup[s.userid].extra),void e.onstreamended(s);var d="both"!=i.message.type?i.message.type:null;return void("function"==typeof s.stream[a]&&s.stream[a](d))}if("dropPeerConnection"===i.message)return void e.deletePeer(i.sender);if(i.message.allParticipants)return-1===i.message.allParticipants.indexOf(i.sender)&&i.message.allParticipants.push(i.sender),void i.message.allParticipants.forEach(function(n){r[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:t(e.session)})});if(i.message.newParticipant){if(i.message.newParticipant==e.userid)return;if(e.peers[i.message.newParticipant])return;return void r.createNewPeer(i.message.newParticipant,i.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:t(e.session)})}if(i.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia))return void setTimeout(function(){n(i)},1);if(i.message.newParticipationRequest&&i.sender!==e.userid){e.peers[i.sender]&&e.deletePeer(i.sender);var c={extra:i.extra||{},localPeerSdpConstraints:i.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:i.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:void 0!==i.message.isOneWay?i.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:void 0!==i.message.isDataOnly?i.message.isDataOnly:t(e.session),dontGetRemoteStream:void 0!==i.message.isOneWay?i.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!i.message.dontGetRemoteStream,connectionDescription:i,successCallback:function(){}};return void e.onNewParticipant(i.sender,c)}return i.message.changedUUID&&e.peers[i.message.oldUUID]&&(e.peers[i.message.newUUID]=e.peers[i.message.oldUUID],delete e.peers[i.message.oldUUID]),i.message.userLeft?(r.onUserLeft(i.sender),void(i.message.autoCloseEntireSession&&e.leave())):void r.addNegotiatedMessage(i.message,i.sender)}});var s=!1;e.socket.resetProps=function(){s=!1},e.socket.on("connect",function(){s||(s=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra)},1e3),n&&n(e.socket))}),e.socket.on("disconnect",function(n){e.onSocketDisconnect(n)}),e.socket.on("error",function(n){e.onSocketError(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]&&e.peers[n].extra||{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]&&e.peers[n].extra||{}})}),e.socket.on("closed-entire-session",function(n,t){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:t})}),e.socket.on("userid-already-taken",function(n,t){e.onUserIdAlreadyTaken(n,t)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)}),e.socket.on("number-of-broadcast-viewers-updated",function(n){e.onNumberOfBroadcastViewersUpdated(n)}),e.socket.on("set-isInitiator-true",function(n){n==e.sessionid&&(e.isInitiator=!0)})}function o(e){function n(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}var t=this,o=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var e=0;for(var n in this)-1==o.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==o.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var t in this)-1==o.indexOf(t)&&t!=e&&n.push(t);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(n,o){var i=this;if(!l(n.size)&&!l(n.type)){if(e.enableFileSharing)return void t.shareFile(n,o);"string"!=typeof n&&(n=JSON.stringify(n))}if("text"===n.type||n instanceof ArrayBuffer||n instanceof DataView){if("text"===n.type&&(n=JSON.stringify(n)),o){var r=e.peers[o];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(n)}):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout(function(){i.send(n,o)},3e3))}this.getAllParticipants().forEach(function(t){return i[t].channels.length?void i[t].channels.forEach(function(e){e.send(n)}):(e.peers[t].createDataChannel(),e.renegotiate(t),void setTimeout(function(){i[t].channels.forEach(function(e){e.send(n)})},3e3))})}else D.send({text:n,channel:this,connection:e,remoteUserId:o})}},this.uuid=e.userid,this.getLocalConfig=function(o,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){t.onNegotiationNeeded(e,i)},onLocalCandidate:function(n){(n=M.processCandidates(e,n))&&t.onNegotiationNeeded(n,i)},remoteSdp:o,onDataChannelMessage:function(o){if(!e.fbr&&e.enableFileSharing&&n(),"string"!=typeof o&&e.enableFileSharing){var r=this;return o instanceof ArrayBuffer||o instanceof DataView?void e.fbr.convertToObject(o,function(e){r.onDataChannelMessage(e)}):o.readyForNextChunk?void e.fbr.getNextChunk(o,function(n,t){e.peers[i].channels.forEach(function(e){e.send(n)})},i):o.chunkMissing?void e.fbr.chunkMissing(o):void e.fbr.addChunk(o,function(n){e.peers[i].peer.channel.send(n)})}t.onDataChannelMessage(o,i)},onDataChannelError:function(e){t.onDataChannelError(e,i)},onDataChannelOpened:function(e){t.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){t.onDataChannelClosed(e,i)},onRemoteStream:function(n){e.peers[i]&&e.peers[i].streams.push(n),t.onGettingRemoteMedia(n,i)},onRemoteStreamRemoved:function(e){t.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){t.onPeerStateChanged(e),"new"===e.iceConnectionState&&t.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&t.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(t.onUserLeft(i),t.disconnectWith(i))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var o=this.getLocalConfig(null,n,t);e.peers[n]=new h(o)}},this.createAnsweringPeer=function(n,t,o){o=e.setUserPreferences(o||{},t);var i=this.getLocalConfig(n,t,o);e.peers[t]=new h(i)},this.renegotiatePeer=function(n,t,o){if(e.peers[n]){t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var i=this.getLocalConfig(o,n,t);e.peers[n]=new h(i)}else e.enableLogs&&console.error("Peer ("+n+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(n,t,o){if(!e.peers[t])throw"This peer ("+t+") does not exist.";var i=e.peers[t].peer;return i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?void i.getSenders().forEach(function(i){o&&"video"===i.track.kind&&(e.peers[t].peer.lastVideoTrack=i.track,i.replaceTrack(n)),o||"audio"!==i.track.kind||(e.peers[t].peer.lastAudioTrack=i.track,i.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),void this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(n,o){if(n.type&&n.sdp)return"answer"==n.type&&e.peers[o]&&e.peers[o].addRemoteSdp(n),"offer"==n.type&&(n.renegotiatingPeer?this.renegotiatePeer(o,null,n):this.createAnsweringPeer(n,o)),void(e.enableLogs&&console.log("Remote peer's sdp:",n.sdp));if(n.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(n),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",n.candidate));if(n.enableMedia){e.session=n.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),n.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),n.userPreferences.streamsToShare=i,t.onNegotiationNeeded({readyForOffer:!0,userPreferences:n.userPreferences},o)}n.readyForOffer&&e.onReadyForOffer(o,n.userPreferences)},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(t,o){n(),e.fbr.readAsArrayBuffer(t,function(n){var t=e.getAllParticipants();o&&(t=[o]),t.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new S(e);this.onDataChannelMessage=function(n,t){i.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){return e.peers[t].channels.length?void(e.peers[t].channels=[n]):(e.peers[t].channels.push(n),void e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]}}function i(e,n,t){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(n,{arguments:t,__exposedProps__:t});e.dispatchEvent(o)}}function r(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function s(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,o=e.length;t<o;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function a(e,n,t){if(t.autoCreateMediaElement){var o=!1;m(e,"video").length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(t.session.video||t.session.screen)&&(o=!1);var i=document.createElement(o?"audio":"video");if(i.srcObject=e,i.setAttribute("autoplay",!0),i.setAttribute("playsinline",!0),i.setAttribute("controls",!0),i.setAttribute("muted",!1),i.setAttribute("volume",1),"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),O.onSyncNeeded(e.streamid,r),t.attachStreams.forEach(function(n,o){e.streamid===n.streamid&&delete t.attachStreams[o]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var o=t.streamEvents[e.streamid];if(o)return void t.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var s=i.play();if(void 0!==s){var a=!1;setTimeout(function(){a||(a=!0,n(i))},1e3),s.then(function(){a||(a=!0,n(i))}).catch(function(e){a||(a=!0,n(i))})}else n(i)}else n({})}function d(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function c(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function u(e){return!e.audio&&!e.video&&!e.screen&&e.data}function l(e){return void 0===e}function f(e,n){return!(e.session.audio&&"two-way"===e.session.audio||("Firefox"!==DetectRTC.browser.name||!1===n)&&("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50||!0!==typeof n&&(void 0!==n||!e.session.audio||!e.session.screen||e.session.video||(n=!0,0))))}function m(e,n){return e&&e.getTracks?e.getTracks().filter(function(e){return e.kind===(n||"audio")}):[]}function p(){var e=!1;try{if("undefined"==typeof RTCRtpTransceiver)return!1;if(!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var n=new y;try{n.addTransceiver("audio"),e=!0}catch(e){}n.close()}catch(n){e=!1}return e&&function(){var e=!1;try{var n=new y({sdpSemantics:"unified-plan"});try{var t=n.getConfiguration();e="unified-plan"==t.sdpSemantics||(t.sdpSemantics,!1)}catch(n){e=!1}}catch(n){e=!1}return e}()}function v(){if("undefined"!=typeof cordova&&void 0!==cordova.plugins&&void 0!==cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}function g(e){return{OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo}}function h(e){function n(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},s.channel=n}function t(n){s[n](k.sdpConstraints).then(function(n){"Safari"!==DetectRTC.browser.name&&(n.sdp=o.processSdp(n.sdp)),s.setLocalDescription(n).then(function(){o.trickleIce&&(e.onLocalSdp({type:n.type,sdp:n.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:v}),o.onSettingLocalDescription(i))},function(e){o.enableLogs&&console.error("setLocalDescription error",e)})},function(e){o.enableLogs&&console.error("sdp-error",e)})}if(void 0!==window.RTCPeerConnection?y=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?y=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(y=webkitRTCPeerConnection),T=window.RTCSessionDescription||window.mozRTCSessionDescription,R=window.RTCIceCandidate||window.mozRTCIceCandidate,E=window.MediaStreamTrack,!y)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var o=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:o.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){o.addStream(e,i.userid)},this.removeStream=function(e){o.removeStream(e,i.userid)};var i=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var r={};k.sdpConstraints=g({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var s,a=!!e.renegotiatingPeer;e.remoteSdp&&(a=!!e.remoteSdp.renegotiatingPeer);var d=[];if(o.attachStreams.forEach(function(e){e&&d.push(e)}),a)s=e.peerRef;else{var c="all";(o.candidates.turn||o.candidates.relay)&&(o.candidates.stun||o.candidates.reflexive||o.candidates.host||(c="relay"));try{var u={iceServers:o.iceServers,iceTransportPolicy:o.iceTransportPolicy||c};void 0!==o.iceCandidatePoolSize&&(u.iceCandidatePoolSize=o.iceCandidatePoolSize),void 0!==o.bundlePolicy&&(u.bundlePolicy=o.bundlePolicy),void 0!==o.rtcpMuxPolicy&&(u.rtcpMuxPolicy=o.rtcpMuxPolicy),o.sdpSemantics&&(u.sdpSemantics=o.sdpSemantics||"unified-plan"),o.iceServers&&o.iceServers.length||(u=null,o.optionalArgument=null),s=new y(u,o.optionalArgument)}catch(e){try{u={iceServers:o.iceServers};s=new y(u)}catch(e){s=new y}}}!s.getRemoteStreams&&s.getReceivers&&(s.getRemoteStreams=function(){var e=new b;return s.getReceivers().forEach(function(n){e.addTrack(n.track)}),[e]}),!s.getLocalStreams&&s.getSenders&&(s.getLocalStreams=function(){var e=new b;return s.getSenders().forEach(function(n){e.addTrack(n.track)}),[e]}),s.onicecandidate=function(n){if(n.candidate)o.trickleIce&&e.onLocalCandidate({candidate:n.candidate.candidate,sdpMid:n.candidate.sdpMid,sdpMLineIndex:n.candidate.sdpMLineIndex});else if(!o.trickleIce){var t=s.localDescription;e.onLocalSdp({type:t.type,sdp:t.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:i.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:o?o.extra:{},streamsToShare:v})}},d.forEach(function(n){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(n=o.beforeAddingStream(n,i))&&(s.getLocalStreams().forEach(function(e){n&&e.id==n.id&&(n=null)}),n&&n.getTracks&&n.getTracks().forEach(function(e){try{s.addTrack(e,n)}catch(e){}}))}),s.oniceconnectionstatechange=s.onsignalingstatechange=function(){var n=i.extra;o.peers[i.userid]&&(n=o.peers[i.userid].extra||n),s&&(e.onPeerStateChanged({iceConnectionState:s.iceConnectionState,iceGatheringState:s.iceGatheringState,signalingState:s.signalingState,extra:n,userid:i.userid}),s&&s.iceConnectionState&&-1!==s.iceConnectionState.search(/closed|failed/gi)&&i.streams instanceof Array&&i.streams.forEach(function(e){var n=o.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"};o.onstreamended(n)}))};var l={OfferToReceiveAudio:!!d.length,OfferToReceiveVideo:!!d.length};e.localPeerSdpConstraints&&(l=e.localPeerSdpConstraints),k.sdpConstraints=g(l);var f={};s.ontrack=function(n){if(n&&"track"===n.type){if(n.stream=n.streams[n.streams.length-1],n.stream.id||(n.stream.id=n.track.id),f[n.stream.id]&&"Safari"!==DetectRTC.browser.name)return void(n.track&&(n.track.onended=function(){s&&s.onremovestream(n)}));f[n.stream.id]=n.stream.id;var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var o=t[n.stream.id];o?(n.stream.isAudio=o.isAudio,n.stream.isVideo=o.isVideo,n.stream.isScreen=o.isScreen):(n.stream.isVideo=!!m(n.stream,"video").length,n.stream.isAudio=!n.stream.isVideo,n.stream.isScreen=!1),n.stream.streamid=n.stream.id,r[n.stream.id]=n.stream,e.onRemoteStream(n.stream),n.stream.getTracks().forEach(function(e){e.onended=function(){s&&s.onremovestream(n)}}),n.stream.onremovetrack=function(){s&&s.onremovestream(n)}}},s.onremovestream=function(n){n.stream.streamid=n.stream.id,r[n.stream.id]&&delete r[n.stream.id],e.onRemoteStreamRemoved(n.stream)},"function"!=typeof s.removeStream&&(s.removeStream=function(e){e.getTracks().forEach(function(n){s.removeTrack(n,e)})}),this.addRemoteCandidate=function(e){s.addIceCandidate(new R(e))},this.addRemoteSdp=function(e,n){n=n||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=o.processSdp(e.sdp)),s.setRemoteDescription(new T(e)).then(n,function(t){o.enableLogs&&console.error("setRemoteDescription failed","\n",t,"\n",e.sdp),n()}).catch(function(t){o.enableLogs&&console.error("setRemoteDescription failed","\n",t,"\n",e.sdp),n()})};var p=!0;e.remoteSdp&&(p=!1),this.createDataChannel=function(){n(s.createDataChannel("sctp",{}))},!0!==o.session.data||a||(p?this.createDataChannel():s.ondatachannel=function(e){n(e.channel)}),this.enableDisableVideoEncoding=function(e){var n;if(s.getSenders().forEach(function(e){n||"video"!==e.track.kind||(n=e)}),n&&n.getParameters){var t=n.getParameters();t.encodings[1]&&(t.encodings[1].active=!!e),t.encodings[2]&&(t.encodings[2].active=!!e),n.setParameters(t)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(l=e.remoteSdp.remotePeerSdpConstraints),k.sdpConstraints=g(l),this.addRemoteSdp(e.remoteSdp,function(){t("createAnswer")})),"two-way"!=o.session.audio&&"two-way"!=o.session.video&&"two-way"!=o.session.screen||(k.sdpConstraints=g({OfferToReceiveAudio:"two-way"==o.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==o.session.video||"two-way"==o.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var v={};s.getLocalStreams().forEach(function(e){v[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),p&&t("createOffer"),s.nativeClose=s.close,s.close=function(){if(s){try{s.nativeClose!==s.close&&s.nativeClose()}catch(e){}s=null,i.peer=null}},this.peer=s}function w(e){function n(n,o){!function(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}(e.localMediaConstraints,n);var i="ended";"oninactive"in n&&(i="inactive"),n.addEventListener(i,function(){delete currentUserMediaRequest.streams[t],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=c(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[t]={stream:n},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&w(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(n,o)}if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var t=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[t])n(currentUserMediaRequest.streams[t].stream,!0);else{if(!!/BB10|BlackBerry/i.test(navigator.userAgent||"")||void 0===navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,n(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});if(void 0===navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var o,i,r=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),o=stream},function(e){r(e),i=e}),{then:function(e){return o?void e(o):(e,{then:function(e){return i?void e(i):void(r=e)}})}}}}}if(!0===e.localMediaConstraints.isScreen){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,n(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)});else{if(!navigator.getDisplayMedia)throw new Error("getDisplayMedia API is not availabe in this browser.");navigator.getDisplayMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,n(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||s(),e.idInstance=t,n(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e)}function S(e){var n={};return{receive:function(t,o,i){var r=t.uuid;if(n[r]||(n[r]=[]),n[r].push(t.message),t.last){var s=n[r].join("");t.isobject&&(s=JSON.parse(s));var a={data:s,userid:o,extra:i,latency:(new Date).getTime()-t.sendingTime};e.autoTranslateText?(a.original=a.data,e.Translator.TranslateText(a.data,function(n){a.data=n,e.onmessage(a)})):e.onmessage(a),delete n[r]}}}}var C;(C="undefined"!=typeof global?global:null)&&"undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:"Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",getUserMedia:function(){}},global.console||(global.console={}),void 0===global.console.debug&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),"undefined"==typeof document&&(C.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var e={getContext:function(){return e},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return e},document.addEventListener=document.removeEventListener=C.addEventListener=C.removeEventListener=function(){},C.HTMLVideoElement=C.HTMLMediaElement=function(){}),"undefined"==typeof io&&(C.io=function(){return{on:function(e,n){n=n||function(){},"connect"===e&&n()},emit:function(e,n,t){t=t||function(){},"open-room"!==e&&"join-room"!==e||t(!0,n.sessionid,null)}}}),"undefined"==typeof location&&(C.location={protocol:"file:",href:"",hash:"",origin:"self"}),"undefined"==typeof screen&&(C.screen={width:0,height:0}),"undefined"==typeof URL&&(C.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),C.window=global),function(){function e(e,n){var t=0,o=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),n(o)),t++>50&&(window.clearInterval(i),n(o=!0))},10)}var n,t="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if(w="object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var o=process.versions.node.toString().replace("v","");t="Nodejs/"+o+" (NodeOS) AppleWebKit/"+o+" (KHTML, like Gecko) Nodejs/"+o+" Nodejs/"+o}n="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:t,getUserMedia:function(){}},n.window=global),"undefined"==typeof location&&(n.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(n.screen={width:0,height:0}));var i=window.navigator;void 0!==i?(void 0!==i.webkitGetUserMedia&&(i.getUserMedia=i.webkitGetUserMedia),void 0!==i.mozGetUserMedia&&(i.getUserMedia=i.mozGetUserMedia)):i={getUserMedia:function(){},userAgent:t};var r,s,a=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(i.userAgent||""),d=!(-1===i.userAgent.indexOf("Edge")||!i.msSaveOrOpenBlob&&!i.msSaveBlob),c=!!window.opera||i.userAgent.indexOf(" OPR/")>=0,u=void 0!==window.InstallTrigger,l=/^((?!chrome|android).)*safari/i.test(i.userAgent),f=!!window.chrome&&!c,m="undefined"!=typeof document&&!!document.documentMode&&!d,p={Android:function(){return i.userAgent.match(/Android/i)},BlackBerry:function(){return i.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return i.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return i.userAgent.match(/Opera Mini/i)},Windows:function(){return i.userAgent.match(/IEMobile/i)},any:function(){return p.Android()||p.BlackBerry()||p.iOS()||p.Opera()||p.Windows()},getOsName:function(){var e="Unknown OS";return p.Android()&&(e="Android"),p.BlackBerry()&&(e="BlackBerry"),p.iOS()&&(e="iOS"),p.Opera()&&(e="Opera Mini"),p.Windows()&&(e="Windows"),e}},v="Unknown OS",g="Unknown OS Version",h=function(){for(var e,n=i.appVersion,t=i.userAgent,o="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0;e=r[s];s++)if(e.r.test(t)){o=e.s;break}var a="-";switch(/Windows/.test(o)&&(/Windows (.*)/.test(o)&&(a=/Windows (.*)/.exec(o)[1]),o="Windows"),o){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(a=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(n))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:o,osVersion:a}}();h&&h.osName&&"-"!=h.osName?(v=h.osName,g=h.osVersion):p.any()&&("Android"==(v=p.getOsName())&&(g=!!(s=(r=(r||i.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&s[1]));var w="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===v&&w&&(v="Nodejs",g=process.versions.node.toString().replace("v",""));var S=!1,C=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!S&&e in document.createElement("canvas")&&(S=!0),!C&&e in document.createElement("video")&&(C=!0))});var b=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,y=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,k=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/,T=[],R=[],x=[],M=[];i.mediaDevices&&i.mediaDevices.enumerateDevices&&(i.enumerateDevices=function(e){var n=i.mediaDevices.enumerateDevices();n&&n.then?i.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var P=!1;void 0!==E&&"getSources"in E?P=!0:i.mediaDevices&&i.mediaDevices.enumerateDevices&&(P=!0);var O=!1,D=!1,A=!1,L=!1,U=!1,I=window.DetectRTC||{};I.browser=function(){var e,n,t,o=(i.appVersion,i.userAgent),r=i.appName,s=""+parseFloat(i.appVersion),a=parseInt(i.appVersion,10);if(l&&!f&&-1!==o.indexOf("CriOS")&&(l=!1,f=!0),c){r="Opera";try{a=(s=i.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){s="0.0.0.0",a=0}}else m?((n=o.indexOf("rv:"))>0?s=o.substring(n+3):(n=o.indexOf("MSIE"),s=o.substring(n+5)),r="IE"):f?(n=o.indexOf("Chrome"),r="Chrome",s=o.substring(n+7)):l?(n=o.indexOf("Safari"),r="Safari",s=o.substring(n+7),-1!==(n=o.indexOf("Version"))&&(s=o.substring(n+8)),-1!==i.userAgent.indexOf("Version/")&&(s=i.userAgent.split("Version/")[1].split(" ")[0])):u?(n=o.indexOf("Firefox"),r="Firefox",s=o.substring(n+8)):(e=o.lastIndexOf(" ")+1)<(n=o.lastIndexOf("/"))&&(r=o.substring(e,n),s=o.substring(n+1),r.toLowerCase()===r.toUpperCase()&&(r=i.appName));return d&&(r="Edge",s=i.userAgent.split("Edge/")[1]),-1!==(t=s.search(/[; \)]/))&&(s=s.substring(0,t)),a=parseInt(""+s,10),isNaN(a)&&(s=""+parseFloat(i.appVersion),a=parseInt(i.appVersion,10)),{fullVersion:s,version:a,name:r,isPrivateBrowsing:!1}}(),function(n){var t;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){t=!1},function(e){t=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var o;try{(o=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){t=!0}void 0===t&&e(function(){return"done"===o.readyState},function(e){e||(t=!o.result)})}else if(function(e){var n=e.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&parseInt(t[1],10)>=10)}(window.navigator.userAgent)){t=!1;try{window.indexedDB||(t=!0)}catch(e){t=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){t=!0}void 0===t&&(t=!1,window.localStorage.removeItem("test"))}}catch(e){t=!1}e(function(){return void 0!==t},function(e){n(t)})}(function(e){I.browser.isPrivateBrowsing=!!e}),I.browser["is"+I.browser.name]=!0,I.osName=v,I.osVersion=g;var N=("object"==typeof process&&"object"==typeof process.versions&&process.versions["node-webkit"],!1);["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){N||e in window&&(N=!0)}),I.isWebRTCSupported=N,I.isORTCSupported="undefined"!=typeof RTCIceGatherer;var W=!1;(I.browser.isChrome&&I.browser.version>=35?W=!0:I.browser.isFirefox&&I.browser.version>=34?W=!0:I.browser.isEdge&&I.browser.version>=17?W=!0:"Android"===I.osName&&I.browser.isChrome&&(W=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||""))||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(I.browser.isChrome||I.browser.isEdge||I.browser.isOpera)?W=!1:I.browser.isFirefox&&(W=!1));I.isScreenCapturingSupported=W;var V={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){V.isSupported||e in window&&(V.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(V.isCreateMediaStreamSourceSupported=!0))}),I.isAudioContextSupported=V.isSupported,I.isCreateMediaStreamSourceSupported=V.isCreateMediaStreamSourceSupported;var B=!1;I.browser.isChrome&&I.browser.version>31&&(B=!0),I.isRtpDataChannelsSupported=B;var F=!1;I.browser.isFirefox&&I.browser.version>28?F=!0:I.browser.isChrome&&I.browser.version>25?F=!0:I.browser.isOpera&&I.browser.version>=11&&(F=!0),I.isSctpDataChannelsSupported=F,I.isMobileDevice=a;var q=!1;i.getUserMedia?q=!0:i.mediaDevices&&i.mediaDevices.getUserMedia&&(q=!0),I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(q="Requires HTTPs"),"Nodejs"===I.osName&&(q=!1),I.isGetUserMediaSupported=q;var G,j,H,z="";screen.width&&(z+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:""));I.displayResolution=z,I.displayAspectRatio=(G=screen.width,j=screen.height,H=function e(n,t){return 0==t?n:e(t,n%t)}(G,j),G/H/(j/H)).toFixed(2),I.isCanvasSupportsStreamCapturing=S,I.isVideoSupportsStreamCapturing=C,"Chrome"==I.browser.name&&I.browser.version>=53&&(I.isCanvasSupportsStreamCapturing||(I.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),I.isVideoSupportsStreamCapturing||(I.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),I.DetectLocalIPAddress=function(e,n){if(I.isWebRTCSupported){var t=!0,o=!0;!function(e,n){function t(n){if(n){var t=y.exec(n);if(t){var o=t[1],r=n.match(b);void 0===i[o]&&e(o,r,!0),i[o]=!0}}else e()}function o(){var e=c.localDescription.sdp.split("\n");e.forEach(function(e){e&&0===e.indexOf("a=candidate:")&&t(e)})}if("undefined"!=typeof document&&"function"==typeof document.getElementById){var i={},r=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!r){var s=document.getElementById("iframe");if(!s)return;var a=s.contentWindow;r=a.RTCPeerConnection||a.mozRTCPeerConnection||a.webkitRTCPeerConnection}if(r){var d=null;"Chrome"===I.browser&&I.browser.version<58&&(d={optional:[{RtpDataChannels:!0}]});var c=new r({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},d);if(n&&(c.addStream?c.addStream(n):c.addTrack&&n.getTracks()[0]&&c.addTrack(n.getTracks()[0],n)),c.onicecandidate=function(e){e.candidate&&e.candidate.candidate?t(e.candidate.candidate):t()},!n)try{c.createDataChannel("sctp",{})}catch(e){}I.isPromisesSupported?c.createOffer().then(function(e){c.setLocalDescription(e).then(o)}):c.createOffer(function(e){c.setLocalDescription(e,o,function(){})},function(){})}}}(function(n){n?n.match(b)?e("Local: "+n,t=!1,o):n.match(k)?e("Public: "+n,t,o=!1):e("Public: "+n,t,o):e()},n)}},I.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,I.isWebSocketsBlocked=!I.isWebSocketsSupported,"Nodejs"===I.osName&&(I.isWebSocketsSupported=!0,I.isWebSocketsBlocked=!1),I.checkWebSocketsSupport=function(e){e=e||function(){};try{var n,t=new WebSocket("wss://echo.websocket.org:443/");t.onopen=function(){I.isWebSocketsBlocked=!1,n=(new Date).getTime(),t.send("ping")},t.onmessage=function(){I.WebsocketLatency=(new Date).getTime()-n+"ms",e(),t.close(),t=null},t.onerror=function(){I.isWebSocketsBlocked=!0,e()}}catch(n){I.isWebSocketsBlocked=!0,e()}},I.load=function(e){(function(e){if(P)if(!i.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(i.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!i.enumerateDevices&&i.enumerateDevices&&(i.enumerateDevices=i.enumerateDevices.bind(i)),i.enumerateDevices){T=[],R=[],x=[],M=[],O=!1,D=!1,A=!1,L=!1,U=!1;var n={};i.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var o in e)try{"function"!=typeof e[o]&&(t[o]=e[o])}catch(e){}n[t.deviceId+t.label+t.kind]||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||U||(U=!0),"audioinput"!==t.kind||L||(L=!0)):(t.isCustomLabel=!0,"videoinput"===t.kind?t.label="Camera "+(M.length+1):"audioinput"===t.kind?t.label="Microphone "+(R.length+1):"audiooutput"===t.kind?t.label="Speaker "+(x.length+1):t.label="Please invoke getUserMedia once.",void 0!==I&&I.browser.isChrome&&I.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(O=!0,-1===R.indexOf(t)&&R.push(t)),"audiooutput"===t.kind&&(D=!0,-1===x.indexOf(t)&&x.push(t)),"videoinput"===t.kind&&(A=!0,-1===M.indexOf(t)&&M.push(t)),T.push(t),n[t.deviceId+t.label+t.kind]=t)}),void 0!==I&&(I.MediaDevices=T,I.hasMicrophone=O,I.hasSpeakers=D,I.hasWebcam=A,I.isWebsiteHasWebcamPermissions=U,I.isWebsiteHasMicrophonePermissions=L,I.audioInputDevices=R,I.audioOutputDevices=x,I.videoInputDevices=M),e&&e()})}else e&&e();else e&&e()})(e=e||function(){})},I.MediaDevices=void 0!==T?T:[],I.hasMicrophone=O,I.hasSpeakers=D,I.hasWebcam=A,I.isWebsiteHasWebcamPermissions=U,I.isWebsiteHasMicrophonePermissions=L,I.audioInputDevices=R,I.audioOutputDevices=x,I.videoInputDevices=M;var _=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(_=!0),I.isSetSinkIdSupported=_;var J=!1;I.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(J=!0):I.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(J=!0),I.isRTPSenderReplaceTracksSupported=J;var X=!1;I.browser.isFirefox&&I.browser.version>38&&(X=!0),I.isRemoteStreamProcessingSupported=X;var K=!1;void 0!==E&&"applyConstraints"in E.prototype&&(K=!0),I.isApplyConstraintsSupported=K;var Y=!1;I.browser.isFirefox&&I.browser.version>=43&&(Y=!0),I.isMultiMonitorScreenCapturingSupported=Y,I.isPromisesSupported=!!("Promise"in window),I.version="1.3.9",void 0===I&&(window.DetectRTC={});var $=window.MediaStream;void 0===$&&"undefined"!=typeof webkitMediaStream&&($=webkitMediaStream),I.MediaStream=void 0!==$&&"function"==typeof $&&Object.keys($.prototype),I.MediaStreamTrack=void 0!==E&&Object.keys(E.prototype);var Q=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;I.RTCPeerConnection=void 0!==Q&&Object.keys(Q.prototype),window.DetectRTC=I,"undefined"!=typeof module&&(module.exports=I),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return I})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,o){e.addEventListener(n,t,o)};var b=window.MediaStream;void 0===b&&"undefined"!=typeof webkitMediaStream&&(b=webkitMediaStream),void 0!==b&&("stop"in b.prototype||(b.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker",document.addEventListener("deviceready",v,!1),v();var y,k={};void 0!==window.RTCPeerConnection?y=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?y=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(y=webkitRTCPeerConnection);var T=window.RTCSessionDescription||window.mozRTCSessionDescription,R=window.RTCIceCandidate||window.mozRTCIceCandidate,E=window.MediaStreamTrack,x=function(){function e(e,o){var i=t(e);return i.videoCodecNumbers?"vp8"===o&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===o&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===o&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=n(e,o,i):e}function n(e,n,t,o){var i="";if("vp8"===n){if(!t.vp8LineNumber)return e;i=t.vp8LineNumber}if("vp9"===n){if(!t.vp9LineNumber)return e;i=t.vp9LineNumber}if("h264"===n){if(!t.h264LineNumber)return e;i=t.h264LineNumber}var r=t.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",s=[i];return o&&(s=[]),t.videoCodecNumbers.forEach(function(e){e!==i&&s.push(e)}),r+=s.join(" "),e.replace(t.videoCodecNumbersOriginal,r)}function t(e){var n={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(n.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(t){(t=t.trim())&&t.length&&(n.videoCodecNumbers.push(t),n.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||n.vp8LineNumber||(n.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||n.vp9LineNumber||(n.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||n.h264LineNumber||(n.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),n}function o(e,n,t){return function(e,n,t,o,i){for(var r=-1!==t?t:e.length,s=n;s<r;++s)if(0===e[s].indexOf(o)&&(!i||-1!==e[s].toLowerCase().indexOf(i.toLowerCase())))return s;return null}(e,0,-1,n,t)}function i(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}return{removeVPX:function(e){var o=t(e);return e=n(e,"vp9",o,!0),n(e,"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),o=0;o<t.codecs.length;o++)if(t.codecs[o].mimeType==e){t.codecs.unshift(t.codecs.splice(o,1));break}n.setParameters(t)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,t){return function(e,n,t){return n?"undefined"!=typeof isFirefox&&isFirefox?e:(t&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n"):n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.video+"\r\n")),e):e}(e,n,t)},setVideoBitrates:function(e,n){return function(e,n){var t,r=(n=n||{}).min,s=n.max,a=e.split("\r\n"),d=o(a,"a=rtpmap","VP8/90000");if(d&&(t=i(a[d])),!t)return e;var c,u=o(a,"a=rtpmap","rtx/90000");if(u&&(c=i(a[u])),!u)return e;var l=o(a,"a=fmtp:"+c.toString());if(null!==l){var f="\r\n";f+="a=fmtp:"+t+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228"),a[l]=a[l].concat(f),e=a.join("\r\n")}return e}(e,n)},setOpusAttributes:function(e,n){return function(e,n){n=n||{};var t,r=e.split("\r\n"),s=o(r,"a=rtpmap","opus/48000");if(s&&(t=i(r[s])),!t)return e;var a=o(r,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+(void 0!==n.stereo?n.stereo:"1"),d+="; sprop-stereo="+(void 0!==n["sprop-stereo"]?n["sprop-stereo"]:"1"),void 0!==n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),void 0!==n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),void 0!==n.cbr&&(d+="; cbr="+(void 0!==n.cbr?n.cbr:"1")),void 0!==n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),void 0!==n.usedtx&&(d+="; usedtx="+n.usedtx),void 0!==n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),r[a]=r[a].concat(d),r.join("\r\n")}(e,n)},preferVP9:function(n){return e(n,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var n=e.split("\r\n"),t=null,o=0;o<n.length;o++)if(-1!==n[o].search("opus/48000")){var i=extractSdp(n[o],/:(\d+) opus\/48000/i);break}for(o=0;o<n.length;o++)if(-1!==n[o].search("a=fmtp")&&extractSdp(n[o],/a=fmtp:(\d+)/)===i){t=o;break}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}}}();window.BandwidthHandler=x;var M=function(){return{processCandidates:function(e,n){var t=n.candidate,o=e.candidates,i=o.stun,r=o.turn;if(l(o.reflexive)||(i=o.reflexive),l(o.relay)||(r=o.relay),(o.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(i||!t.match(/typ srflx/g))){var s=e.iceProtocols;if((s.udp||!t.match(/ udp /g))&&(s.tcp||!t.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}}}}(),P=function(){return{getIceServers:function(e){return[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}]}}}();window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){var t=(n=n.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=c(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var O=function(){function e(e){if(e)return"string"==typeof e||void 0===e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}return{setHandlers:function(n,t,o){function r(){if(o.streamEvents[n.streamid].mediaElement){var e=o.streamEvents[n.streamid].mediaElement;e.volume=0,function e(n,t,o,i){(i=(i||0)+1)>=t||setTimeout(function(){o(),e(n,t,o,i)},n)}(200,5,function(){try{e.volume+=.2}catch(n){e.volume=1}})}}if(n&&n.addEventListener){if(void 0===t||1==t){var s="ended";"oninactive"in n&&(s="inactive"),n.addEventListener(s,function(){O.onSyncNeeded(this.streamid,s)},!1)}n.mute=function(r,s){r=e(r),void 0!==s&&(t=s),void 0!==r&&"audio"!=r||m(n,"audio").forEach(function(e){e.enabled=!1,o.streamEvents[n.streamid].isAudioMuted=!0}),void 0!==r&&"video"!=r||m(n,"video").forEach(function(e){e.enabled=!1}),void 0!==t&&1!=t||O.onSyncNeeded(n.streamid,"mute",r),o.streamEvents[n.streamid].muteType=r||"both",i(n,"mute",r)},n.unmute=function(s,a){s=e(s),void 0!==a&&(t=a),r(),void 0!==s&&"audio"!=s||m(n,"audio").forEach(function(e){e.enabled=!0,o.streamEvents[n.streamid].isAudioMuted=!1}),void 0!==s&&"video"!=s||(m(n,"video").forEach(function(e){e.enabled=!0}),void 0!==s&&"video"==s&&o.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&o.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){e(t)},50))}()),void 0!==t&&1!=t||O.onSyncNeeded(n.streamid,"unmute",s),o.streamEvents[n.streamid].unmuteType=s||"both",i(n,"unmute",s)}}},onSyncNeeded:function(e,n,t){}}}(),D={send:function(e){var n=e.connection,t=e.channel,o=e.remoteUserId,i=e.text,r=n.chunkSize||1e3,a="",d=!1;"string"==typeof i||(d=!0,i=JSON.stringify(i));var c=s(),u=(new Date).getTime();!function e(i,s){var l={type:"text",uuid:c,sendingTime:u};i&&(s=i,l.packets=parseInt(s.length/r)),s.length>r?l.message=s.slice(0,r):(l.message=s,l.last=!0,l.isobject=d),t.send(l,o),(a=s.slice(l.message.length)).length&&setTimeout(function(){e(null,a)},n.chunkInterval||100)}(i)}},A=function(){return{handle:function(e){var n={};e.onFileStart=function(t){var o=document.createElement("div");return o.title=t.name,o.innerHTML="<label>0%</label> <progress></progress>",t.remoteUserId&&(o.innerHTML+=" (Sharing with:"+t.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),t.remoteUserId?(n[t.uuid]||(n[t.uuid]={}),n[t.uuid][t.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(n[t.uuid][t.remoteUserId].progress.max=t.maxChunks)):(n[t.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(n[t.uuid].progress.max=t.maxChunks))},e.onFileProgress=function(e){var t=n[e.uuid];t&&(e.remoteUserId&&!(t=n[e.uuid][e.remoteUserId])||(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,function(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}(t.progress,t.label)))},e.onFileEnd=function(e){var t=n[e.uuid];if(t){if(!e.remoteUserId||(t=n[e.uuid][e.remoteUserId])){var o=t.div;-1!=e.type.indexOf("image")?o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':o.innerHTML='<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}}else console.error("No such progress-helper element exist.",e)}}}}(),L=function(){return{handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var o=document.createElement("script");o.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){return e.data&&e.data.translations[0]&&t?void t(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?void console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?void console.error(e.error.message):void console.error(e)};var s="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i;o.src=s,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(n){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){var e=JSON.parse(t.responseText);if(e&&e.data&&e.data.languages)return void n(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}};var o="https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en";t.open("GET",o,!0),t.send(null)}}}}}();!function(i){function c(e){if(i.socketAutoReConnect=!0,i.socket)e&&e(i.socket);else{if(void 0===t)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new t(i,function(n){e&&e(i.socket)})}}function l(e,n){i.socket.emit("join-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:g(),extra:i.extra,password:void 0!==i.password&&"object"!=typeof i.password?i.password:""},function(t,o){if(!0===t){if(i.enableLogs&&console.log("isRoomJoined: ",t," roomid: ",i.sessionid),i.peers[i.sessionid])return;k.onNegotiationNeeded(e)}!1===t&&i.enableLogs&&console.warn("isRoomJoined: ",o," roomid: ",i.sessionid),n(t,i.sessionid,o)})}function v(e){i.enableLogs&&console.log("Sending open-room signal to socket.io"),i.waitingForLocalMedia=!1,i.socket.emit("open-room",{sessionid:i.sessionid,session:i.session,mediaConstraints:i.mediaConstraints,sdpConstraints:i.sdpConstraints,streams:g(),extra:i.extra,identifier:i.publicRoomIdentifier,password:void 0!==i.password&&"object"!=typeof i.password?i.password:""},function(n,t){!0===n&&(i.enableLogs&&console.log("isRoomOpened: ",n," roomid: ",i.sessionid),e(n,i.sessionid)),!1===n&&(i.enableLogs&&console.warn("isRoomOpened: ",t," roomid: ",i.sessionid),e(n,i.sessionid,t))})}function g(){try{return i.streamEvents.selectAll("local").map(function(e){return{streamid:e.streamid,tracks:e.stream.getTracks().length}})}catch(e){return[]}}function h(e,n){if(!i.dontCaptureUserMedia&&!e.isDataOnly){var t={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(t.audio=i.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(t.video=i.mediaConstraints.video);var o=e.session||i.session;return o.oneway&&"two-way"!==o.audio&&"two-way"!==o.video&&"two-way"!==o.screen?void n():(o.oneway&&o.audio&&"two-way"===o.audio&&(o={audio:!0}),void((o.audio||o.video||o.screen)&&(o.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(e){e.isScreen=!0,k.onGettingLocalMedia(e),!o.audio&&!o.video||f(i)?n(e):i.invokeGetUserMedia(null,n)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},!o.audio&&!o.video||f(i)?n:i.invokeGetUserMedia(null,n)):(o.audio||o.video)&&i.invokeGetUserMedia(null,n,o))))}n()}function S(e,n){return e?(n.audio&&m(e,"audio").forEach(function(e){e.applyConstraints(n.audio)}),void(n.video&&m(e,"video").forEach(function(e){e.applyConstraints(n.video)}))):void(i.enableLogs&&console.error("No stream to applyConstraints."))}function C(e,n,t){return n?void k.replaceTrack(e,n,t):void i.peers.getAllParticipants().forEach(function(n){k.replaceTrack(e,n,t)})}n=n||{useDefaultDevices:!0},i.channel=i.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var k=new o(i),T={};k.onGettingLocalMedia=function(e,n){if(n=n||function(){},T[e.streamid])n();else{T[e.streamid]=!0;try{e.type="local"}catch(e){}i.setStreamEndHandler(e),a(e,function(t){t.id=e.streamid,t.muted=!0,t.volume=0,-1===i.attachStreams.indexOf(e)&&i.attachStreams.push(e),void 0!==O&&O.setHandlers(e,!0,i),i.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:t,userid:i.userid,extra:i.extra,streamid:e.streamid,isAudioMuted:!0};try{(function(e,n){if(n.stream&&m(n.stream,"audio").length){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,o){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:o},n))}})}}})(i,i.streamEvents[e.streamid]),r(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])}catch(e){}n()},i)}},k.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(e){}i.setStreamEndHandler(e,"remote-stream"),a(e,function(t){t.id=e.streamid,void 0!==O&&O.setHandlers(e,!1,i),i.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:i.peers[n]?i.peers[n].extra:{},mediaElement:t,streamid:e.streamid},r(i,i.streamEvents[e.streamid]),i.onstream(i.streamEvents[e.streamid])},i)},k.onRemovingRemoteMedia=function(e,n){var t=i.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:i.peers[n]?i.peers[n].extra:{},streamid:e.streamid,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),i.peersBackup[t.userid]&&(t.extra=i.peersBackup[t.userid].extra),i.onstreamended(t),delete i.streamEvents[e.streamid]},k.onNegotiationNeeded=function(e,n,t){t=t||function(){};var o={remoteUserId:n=n||e.remoteUserId,message:e=e||"",sender:i.userid};e.remoteUserId&&e.message&&e.sender&&(o=e),c(function(){i.socket.emit(i.socketMessageEvent,o,t)})},k.onUserLeft=function(e){i.deletePeer(e)},k.disconnectWith=function(e,n){i.socket&&i.socket.emit("disconnect-with",e,n||function(){}),i.deletePeer(e)},i.socketOptions={transport:"polling"},i.openOrJoin=function(e,n){n=n||function(){},i.checkPresence(e,function(e,t){if(!e)return i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=t||i.sessionid,u(i.session)?void v(n):void i.captureUserMedia(function(){v(n)});i.sessionid=t;var o,r,s=!!i.session.oneway,a=u(i.session);r={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},o={OfferToReceiveAudio:s?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:s?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo};var d={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:s,isDataOnly:a,localPeerSdpConstraints:o,remotePeerSdpConstraints:r},sender:i.userid};h(d.message,function(){l(d,n)})})},i.waitingForLocalMedia=!1,i.open=function(e,n){n=n||function(){},i.waitingForLocalMedia=!0,i.isInitiator=!0,i.sessionid=e||i.sessionid,c(function(){return u(i.session)?void v(n):void i.captureUserMedia(function(){v(n)})})},i.peersBackup={},i.deletePeer=function(e){if(e&&i.peers[e]){var n={userid:e,extra:i.peers[e]?i.peers[e].extra:{}};if(i.peersBackup[n.userid]&&(n.extra=i.peersBackup[n.userid].extra),i.onleave(n),i.peers[e]){i.peers[e].streams.forEach(function(e){e.stop()});var t=i.peers[e].peer;if(t&&"closed"!==t.iceConnectionState)try{t.close()}catch(e){}i.peers[e]&&(i.peers[e].peer=null,delete i.peers[e])}}},i.rejoin=function(e){if(!i.isInitiator&&e&&Object.keys(e).length){var n={};i.peers[e.remoteUserId]&&(n=i.peers[e.remoteUserId].extra,i.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(i.join(e.remoteUserId),i.onReConnecting({userid:e.remoteUserId,extra:n}))}},i.join=function(e,n){i.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||i.sessionid,i.sessionid+="";var t=!1,o=!1,r=!1,s=!1;if(e&&e.session||!e||"string"==typeof e){var a=e&&e.session||i.session;r=!!a.oneway,s=u(a),o={OfferToReceiveAudio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:i.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:r?!!i.session.audio:i.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!i.session.video||!!i.session.screen:i.sdpConstraints.mandatory.OfferToReceiveVideo}}var d=function(){};"function"==typeof(n=n||{})&&(d=n,n={}),void 0!==n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),void 0!==n.remotePeerSdpConstraints&&(o=n.remotePeerSdpConstraints),void 0!==n.isOneWay&&(r=n.isOneWay),void 0!==n.isDataOnly&&(s=n.isDataOnly);var f={remoteUserId:i.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:t,remotePeerSdpConstraints:o},sender:i.userid};return h(f.message,function(){c(function(){l(f,d)})}),f},i.publicRoomIdentifier="",i.getUserMedia=i.captureUserMedia=function(e,n){e=e||function(){};var t=n||i.session;return i.dontCaptureUserMedia||u(t)?void e():void((t.audio||t.video||t.screen)&&(t.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(o){if(o.isScreen=!0,k.onGettingLocalMedia(o),!t.audio&&!t.video||f(i))e(o);else{var r={};for(var s in t)"screen"!==s&&(r[s]=t[s]);i.invokeGetUserMedia(n,e,r)}},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},function(o){if(!t.audio&&!t.video||f(i))e(o);else{var r={};for(var s in t)"screen"!==s&&(r[s]=t[s]);i.invokeGetUserMedia(n,e,r)}}):(t.audio||t.video)&&i.invokeGetUserMedia(n,e,t)))},i.onbeforeunload=function(e,n){i.closeBeforeUnload&&(i.peers.getAllParticipants().forEach(function(e){k.onNegotiationNeeded({userLeft:!0},e),i.peers[e]&&i.peers[e].peer&&i.peers[e].peer.close(),delete i.peers[e]}),n||i.closeSocket(),i.isInitiator=!1)},window.ignoreBeforeUnload?i.closeBeforeUnload=!1:(i.closeBeforeUnload=!0,window.addEventListener("beforeunload",i.onbeforeunload,!1)),i.userid=s(),i.changeUserId=function(e,n){n=n||function(){},i.userid=e||s(),i.socket.emit("changed-uuid",i.userid,n)},i.extra={},i.attachStreams=[],i.session={audio:!0,video:!0},i.enableFileSharing=!1,i.bandwidth={screen:!1,audio:!1,video:!1},i.codecs={audio:"opus",video:"VP9"},i.processSdp=function(e){return p()?e:"Safari"===DetectRTC.browser.name?e:("VP8"===i.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"vp8")),"VP9"===i.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"vp9")),"H264"===i.codecs.video.toUpperCase()&&(e=x.preferCodec(e,"h264")),"G722"===i.codecs.audio&&(e=x.removeNonG722(e)),"Firefox"===DetectRTC.browser.name?e:((i.bandwidth.video||i.bandwidth.screen)&&(e=x.setApplicationSpecificBandwidth(e,i.bandwidth,!!i.session.screen)),i.bandwidth.video&&(e=x.setVideoBitrates(e,{min:8*i.bandwidth.video*1024,max:8*i.bandwidth.video*1024})),i.bandwidth.audio&&(e=x.setOpusAttributes(e,{maxaveragebitrate:8*i.bandwidth.audio*1024,maxplaybackrate:8*i.bandwidth.audio*1024,stereo:1,maxptime:3})),e))},void 0!==x&&(i.BandwidthHandler=i.CodecsHandler=x),i.mediaConstraints={audio:{mandatory:{},optional:i.bandwidth.audio?[{bandwidth:8*i.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:i.bandwidth.video?[{bandwidth:8*i.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(i.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&!1!==i.mediaConstraints.audio&&(e=t),"videoinput"===t.kind&&!1!==i.mediaConstraints.video&&(n=t)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==i.mediaConstraints.audio?i.mediaConstraints.audio.deviceId=e.id:i.mediaConstraints.audio={deviceId:e.id});1==i.mediaConstraints.audio&&(i.mediaConstraints.audio={mandatory:{},optional:[]}),i.mediaConstraints.audio.optional||(i.mediaConstraints.audio.optional=[]);var t=[{sourceId:e.id}];i.mediaConstraints.audio.optional=t.concat(i.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0!==i.mediaConstraints.video?i.mediaConstraints.video.deviceId=n.id:i.mediaConstraints.video={deviceId:n.id});1==i.mediaConstraints.video&&(i.mediaConstraints.video={mandatory:{},optional:[]}),i.mediaConstraints.video.optional||(i.mediaConstraints.video.optional=[]);t=[{sourceId:n.id}];i.mediaConstraints.video.optional=t.concat(i.mediaConstraints.video.optional)}}),i.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},i.sdpSemantics=null,i.iceCandidatePoolSize=null,i.bundlePolicy=null,i.rtcpMuxPolicy=null,i.iceTransportPolicy=null,i.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},i.iceServers=P.getIceServers(i),i.candidates={host:!0,stun:!0,turn:!0},i.iceProtocols={tcp:!0,udp:!0},i.onopen=function(e){i.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},i.onclose=function(e){i.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},i.onerror=function(e){i.enableLogs&&console.error(e.userid,"data-error",e)},i.onmessage=function(e){i.enableLogs&&console.debug("data-message",e.userid,e.data)},i.send=function(e,n){i.peers.send(e,n)},i.close=i.disconnect=i.leave=function(){i.onbeforeunload(!1,!0)},i.closeEntireSession=function(e){e=e||function(){},i.socket.emit("close-entire-session",function n(){return i.getAllParticipants().length?void setTimeout(n,100):(i.onEntireSessionClosed({sessionid:i.sessionid,userid:i.userid,extra:i.extra}),void i.changeUserId(null,function(){i.close(),e()}))})},i.onEntireSessionClosed=function(e){i.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},i.onstream=function(e){var n=i.videosContainer;n.insertBefore(e.mediaElement,n.firstChild);var t=e.mediaElement.play();return void 0!==t?void t.catch(function(){}).then(function(){setTimeout(function(){e.mediaElement.play()},2e3)}):void setTimeout(function(){e.mediaElement.play()},2e3)},i.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},i.direction="many-to-many",i.removeStream=function(e,n){var t;return i.attachStreams.forEach(function(n){n.id===e&&(t=n)}),t?(i.peers.getAllParticipants().forEach(function(e){if(!n||e===n){var o=i.peers[e];try{o.peer.removeStream(t)}catch(e){}}}),void i.renegotiate()):void console.warn("No such stream exist.",e)},i.addStream=function(e,n){function t(t){e.streamCallback&&e.streamCallback(t),i.renegotiate(n)}return e.getTracks?(-1===i.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),i.attachStreams.push(e)),void i.renegotiate(n)):u(e)?void i.renegotiate(n):void((e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(n){n.isScreen=!0,k.onGettingLocalMedia(n),!e.audio&&!e.video||f(i)?t(n):i.invokeGetUserMedia(null,function(e){t(e)})},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},function(n){!e.audio&&!e.video||f(i)?t(n):i.invokeGetUserMedia(null,function(e){t(e)})}):(e.audio||e.video)&&i.invokeGetUserMedia(null,t)))},i.invokeGetUserMedia=function(e,n,t){t||(t=i.session),e||(e=i.mediaConstraints),w({onGettingLocalMedia:function(t){var o=e.video;o&&(o.mediaSource||o.mozMediaSource?t.isScreen=!0:o.mandatory&&o.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=!!m(t,"video").length,t.isAudio=!t.isVideo&&m(t,"audio").length),k.onGettingLocalMedia(t,function(){"function"==typeof n&&n(t)})},onLocalMediaError:function(e,n){k.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},i.applyConstraints=function(e,n){if(E&&E.prototype.applyConstraints){var t;if(n)return i.streamEvents[n]&&(t=i.streamEvents[n].stream),void S(t,e);i.attachStreams.forEach(function(n){S(n,e)})}else alert("track.applyConstraints is NOT supported in your browser.")},i.replaceTrack=function(e,n,t){function o(o){i.replaceTrack(o,n,t||e.video||e.screen)}if(e=e||{},y.prototype.getSenders)if(e instanceof E)C(e,n,t);else{if(e instanceof b)return m(e,"video").length&&C(m(e,"video")[0],n,!0),void(m(e,"audio").length&&C(m(e,"audio")[0],n,!1));if(u(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?"Edge"===DetectRTC.browser.name?navigator.getDisplayMedia({video:!0,audio:f(i)}).then(function(n){n.isScreen=!0,k.onGettingLocalMedia(n),!e.audio&&!e.video||f(i)?o(n):i.invokeGetUserMedia(null,o)},function(e){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):i.invokeGetUserMedia({audio:f(i),video:!0,isScreen:!0},!e.audio&&!e.video||f(i)?o:i.invokeGetUserMedia(null,o)):(e.audio||e.video)&&i.invokeGetUserMedia(null,o))}else i.addStream(e)},i.resetTrack=function(e,n){e||(e=i.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=i.peers[e].peer;void 0!==n&&!0!==n||!t.lastVideoTrack||i.replaceTrack(t.lastVideoTrack,e,!0),void 0!==n&&!1!==n||!t.lastAudioTrack||i.replaceTrack(t.lastAudioTrack,e,!1)})},i.renegotiate=function(e){return e?void k.renegotiatePeer(e):void i.peers.getAllParticipants().forEach(function(e){k.renegotiatePeer(e)})},i.setStreamEndHandler=function(e,n){if(e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var t="ended";"oninactive"in e&&(t="inactive"),e.addEventListener(t,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!n){var t=[];i.attachStreams.forEach(function(n){n.id!=e.id&&t.push(n)}),i.attachStreams=t}var o=i.streamEvents[e.streamid];if(o||(o={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:i.userid,extra:i.extra,mediaElement:i.streamEvents[e.streamid]?i.streamEvents[e.streamid].mediaElement:null}),n&&i.peers[o.userid]){var r=i.peers[o.userid].peer;t=[];r.getRemoteStreams().forEach(function(n){n.id!=e.id&&t.push(n)}),i.peers[o.userid].streams=t}o.userid===i.userid&&"remote"===o.type||(i.peersBackup[o.userid]&&(o.extra=i.peersBackup[o.userid].extra),i.onstreamended(o),delete i.streamEvents[e.streamid])},!1)}},i.onMediaError=function(e,n){i.enableLogs&&console.error(e,n)},i.autoCloseEntireSession=!1,i.filesContainer=i.videosContainer=document.body||document.documentElement,i.isInitiator=!1,i.shareFile=k.shareFile,void 0!==A&&A.handle(i),void 0!==L&&L.handle(i),i.token=s,i.onNewParticipant=function(e,n){i.acceptParticipationRequest(e,n)},i.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),k.createNewPeer(e,n)},void 0!==O&&(i.StreamsHandler=O),i.onleave=function(e){},i.invokeSelectFileDialog=function(e){var n=new FileSelector;n.accept="*.*",n.selectSingleFile(e)},i.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var n=e.mediaElement.pause();void 0!==n?n.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},i.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},i.onExtraDataUpdated=function(e){e.status="online",i.onUserStatusChanged(e,!0)},i.getAllParticipants=function(e){return i.peers.getAllParticipants(e)},void 0!==O&&(O.onSyncNeeded=function(e,n,t){i.peers.getAllParticipants().forEach(function(o){k.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},o)})}),i.connectSocket=function(e){c(e)},i.closeSocket=function(){try{io.sockets={}}catch(e){}i.socket&&("function"==typeof i.socket.disconnect&&i.socket.disconnect(),"function"==typeof i.socket.resetProps&&i.socket.resetProps(),i.socket=null)},i.getSocket=function(e){return!e&&i.enableLogs&&console.warn("getSocket.callback paramter is required."),e=e||function(){},i.socket?e(i.socket):c(function(){e(i.socket)}),i.socket},i.getRemoteStreams=k.getRemoteStreams;var R=["selectFirst","selectAll","forEach"];if(i.streamEvents={selectFirst:function(e){return i.streamEvents.selectAll(e)[0]},selectAll:function(e){e||(e={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),"local"==e&&(e={local:!0}),"remote"==e&&(e={remote:!0}),"screen"==e&&(e={isScreen:!0}),"audio"==e&&(e={isAudio:!0}),"video"==e&&(e={isVideo:!0});var n=[];return Object.keys(i.streamEvents).forEach(function(t){var o=i.streamEvents[t];if(-1===R.indexOf(t)){var r=!0;e.local&&"local"===o.type&&(r=!1),e.remote&&"remote"===o.type&&(r=!1),e.isScreen&&o.stream.isScreen&&(r=!1),e.isVideo&&o.stream.isVideo&&(r=!1),e.isAudio&&o.stream.isAudio&&(r=!1),e.userid&&o.userid===e.userid&&(r=!1),!1===r&&n.push(o)}}),n}},i.socketURL="/",i.socketMessageEvent="RTCMultiConnection-Message",i.socketCustomEvent="RTCMultiConnection-Custom-Message",i.DetectRTC=DetectRTC,i.setCustomSocketEvent=function(e){e&&(i.socketCustomEvent=e),i.socket&&i.socket.emit("set-custom-socket-event-listener",i.socketCustomEvent)},i.getNumberOfBroadcastViewers=function(e,n){i.socket&&e&&n&&i.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},i.onNumberOfBroadcastViewersUpdated=function(e){i.enableLogs&&i.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},i.onUserStatusChanged=function(e,n){i.enableLogs&&!n&&console.info(e.userid,e.status)},i.getUserMediaHandler=w,i.multiPeersHandler=k,i.enableLogs=!0,i.setCustomSocketHandler=function(e){void 0!==t&&(t=e)},i.chunkSize=4e4,i.maxParticipantsAllowed=1e3,i.disconnectWith=k.disconnectWith,i.checkPresence=function(e,n){return e=e||i.sessionid,"SSEConnection"===t.name?void SSEConnection.checkPresence(e,function(e,t,o){return i.socket?void n(e,t):(e||(i.userid=t),void i.connectSocket(function(){n(e,t,o)}))}):i.socket?void i.socket.emit("check-presence",e+"",function(e,t,o){i.enableLogs&&console.log("checkPresence.isRoomExist: ",e," roomid: ",t),n(e,t,o)}):void i.connectSocket(function(){i.checkPresence(e,n)})},i.onReadyForOffer=function(e,n){i.multiPeersHandler.createNewPeer(e,n)},i.setUserPreferences=function(e){return i.dontAttachStream&&(e.dontAttachLocalStream=!0),i.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},i.updateExtraData=function(){i.socket.emit("extra-data-updated",i.extra)},i.enableScalableBroadcast=!1,i.maxRelayLimitPerUser=3,i.dontCaptureUserMedia=!1,i.dontAttachStream=!1,i.dontGetRemoteStream=!1,i.onReConnecting=function(e){i.enableLogs&&console.info("ReConnecting with",e.userid,"...")},i.beforeAddingStream=function(e){return e},i.beforeRemovingStream=function(e){return e},"undefined"!=typeof isChromeExtensionAvailable&&(i.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),"undefined"!=typeof isFirefoxExtensionAvailable&&(i.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),"undefined"!=typeof getChromeExtensionStatus&&(i.getChromeExtensionStatus=getChromeExtensionStatus),i.modifyScreenConstraints=function(e){return e},i.onPeerStateChanged=function(e){i.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},i.isOnline=!0,d("online",function(){i.isOnline=!0}),d("offline",function(){i.isOnline=!1}),i.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(i.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),i.isLowBandwidth)){if(i.bandwidth={audio:!1,video:!1,screen:!1},i.mediaConstraints.audio&&i.mediaConstraints.audio.optional&&i.mediaConstraints.audio.optional.length){var M=[];i.mediaConstraints.audio.optional.forEach(function(e){void 0===e.bandwidth&&M.push(e)}),i.mediaConstraints.audio.optional=M}if(i.mediaConstraints.video&&i.mediaConstraints.video.optional&&i.mediaConstraints.video.optional.length){M=[];i.mediaConstraints.video.optional.forEach(function(e){void 0===e.bandwidth&&M.push(e)}),i.mediaConstraints.video.optional=M}}i.getExtraData=function(e,n){if(!e)throw"remoteUserId is required.";return"function"==typeof n?void i.socket.emit("get-remote-user-extra-data",e,function(e,t,o){n(e,t,o)}):i.peers[e]?i.peers[e].extra:i.peersBackup[e]?i.peersBackup[e].extra:{}},n.autoOpenOrJoin&&i.openOrJoin(i.sessionid),i.onUserIdAlreadyTaken=function(e,n){i.close(),i.closeSocket(),i.isInitiator=!1,i.userid=i.token(),i.join(i.sessionid),i.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",i.userid)},i.trickleIce=!0,i.version="3.6.9",i.onSettingLocalDescription=function(e){i.enableLogs&&console.info("Set local description for remote user",e.userid)},i.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},i.autoCreateMediaElement=!0,i.password=null,i.setPassword=function(e,n){n=n||function(){},i.socket?i.socket.emit("set-password",e,n):(i.password=e,n(!0,i.sessionid,null))},i.onSocketDisconnect=function(e){i.enableLogs&&console.warn("socket.io connection is closed")},i.onSocketError=function(e){i.enableLogs&&console.warn("socket.io connection is failed")},i.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}}(this)};"undefined"!=typeof module&&(module.exports=exports=RTCMultiConnection),"function"==typeof define&&define.amd&&define("RTCMultiConnection",[],function(){return RTCMultiConnection});
